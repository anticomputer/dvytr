# DevYeeter Configuration Example
# Copy this file to .dvytr.conf in your project directory and customize as needed

# ==============================================================================
# SUPPLY CHAIN SECURITY (Built-in)
# ==============================================================================
#
# DevYeeter includes two layers of supply chain protection:
#
# 1. Time-Based Protection (pnpm minimum-release-age)
#    - Prevents installation of packages published within 24 hours
#    - Gives community time to identify malicious packages
#    - Configured globally in container: minimum-release-age=1440 (minutes)
#
# 2. Real-Time Malware Scanning (Aikido Safe Chain)
#    - Scans all npm/pnpm/yarn and pip/pip3/uv packages against threat database
#    - Blocks known malware before it reaches your container
#    - Works transparently with all package managers
#
# To allow recently-published packages (e.g., internal packages):
# Mount a custom .npmrc with exclusions:
# ADDITIONAL_VOLUMES=(
#     "$HOME/.npmrc:/home/dev/.npmrc:ro"
# )
#
# Your ~/.npmrc should include:
# minimum-release-age-exclude[]=@your-org/*
# minimum-release-age-exclude[]=your-trusted-package
#
# To disable time-based protection entirely (not recommended):
# Create ~/.npmrc with: minimum-release-age=0
# and mount it as shown above
#
# Note: Safe Chain malware scanning cannot be disabled and provides
# critical protection against known malicious packages.

# Custom container name (optional)
# If not set, it will be generated from the current directory name
# CONTAINER_NAME="my-project-dev"

# Docker port mappings (host_port:container_port)
# Maps host machine ports to container ports
# Example: "8080:3000" means host port 8080 -> container port 3000
DOCKER_PORT_MAPPINGS=(
    # "8080:8080"   # Web server
    # "3000:3000"   # Node.js dev server
    # "5432:5432"   # PostgreSQL
    # "6379:6379"   # Redis
)

# Socat port forwarding inside container (optional, rarely needed)
# Format: "container_listen_port:target_host:target_port"
# Use this ONLY when a service binds to localhost and cannot be configured otherwise.
# For most dev servers (Vite, Next.js, etc.), use --host 0.0.0.0 flag instead!
# Example: "3001:127.0.0.1:3000" forwards container 0.0.0.0:3001 -> 127.0.0.1:3000
SOCAT_FORWARDS=(
    # "3001:127.0.0.1:3000"  # Forward to localhost-bound service
)

# Environment variables
# Set environment variables inside the container
# Supports password managers: use "VAR=passage://path" or "VAR=pass://path" syntax
ENV_VARS=(
    # "NODE_ENV=development"
    # "DEBUG=true"
    # "API_KEY=your-api-key"
    # "DATABASE_URL=postgres://localhost/mydb"
    #
    # Password manager secrets (retrieved automatically at container creation)
    # Passage (https://github.com/FiloSottile/passage):
    # "API_KEY=passage://services/api/production"
    # "DATABASE_PASSWORD=passage://databases/postgres/main"
    #
    # Pass (https://www.passwordstore.org/):
    # "API_KEY=pass://services/api/production"
    # "AWS_SECRET_ACCESS_KEY=pass://aws/credentials/secret"
)

# Additional volume mounts
# Mount additional directories into the container
ADDITIONAL_VOLUMES=(
    # "/host/path:/container/path"
    # "$HOME/.ssh:/home/dev/.ssh:ro"  # SSH keys (read-only)
    # "$HOME/.gitconfig:/home/dev/.gitconfig:ro"  # Git config (read-only)
    # "$HOME/.aws:/home/dev/.aws:ro"  # AWS credentials/config (read-only)
    # "$HOME/.npmrc:/home/dev/.npmrc:ro"  # npm config for private registries (read-only)
    # "/var/run/docker.sock:/var/run/docker.sock"  # Docker socket for docker/docker-compose commands
)

# Additional PATH directories
# Add project directories to PATH (relative to /workspace)
# Useful for projects with custom scripts or binaries in subdirectories
PATH_DIRS=(
    # "bin"           # Adds /workspace/bin to PATH
    # "scripts"       # Adds /workspace/scripts to PATH
    # "node_modules/.bin"  # Adds /workspace/node_modules/.bin to PATH
    # ".dvytr/dependencies/bin"  # Common location for init script dependencies
    # "/absolute/path"     # Absolute paths are also supported
)

# Initialization script (choose one method)
#
# Method 1: RUN_INIT - Embedded script content (recommended, self-contained)
# Bash script that runs once on first container start
# Useful for building dependencies or setting up the workspace
# The script runs as the dev user after UID/GID mapping
# A marker file at .dvytr/.initialized prevents re-running
#
# RECOMMENDED: Use heredoc syntax for easy copy-paste without escaping issues
RUN_INIT=''
# Example: Build a Go binary from a private repo
# RUN_INIT=$(cat <<'EOF'
# #!/bin/bash
# set -e
# echo "=== Building project dependencies ==="
#
# # Configure SSH for GitHub (if using private repos)
# mkdir -p ~/.ssh-local && chmod 700 ~/.ssh-local
# ssh-keyscan -H github.com >> ~/.ssh-local/known_hosts 2>/dev/null
# export GIT_SSH_COMMAND="ssh -o UserKnownHostsFile=$HOME/.ssh-local/known_hosts -o StrictHostKeyChecking=accept-new"
#
# # Build dependencies
# mkdir -p .dvytr/dependencies/bin
# export GOBIN="$(pwd)/.dvytr/dependencies/bin"
# GOPRIVATE=github.com/myorg go install -v github.com/myorg/tool@latest
#
# echo "=== Dependencies ready in .dvytr/dependencies/bin/ ==="
# EOF
# )
# Then add to PATH_DIRS: ".dvytr/dependencies/bin"
#
# NOTE: The <<'EOF' syntax (quoted delimiter) prevents variable expansion
# and allows you to use single quotes freely inside the script without escaping
#
# Method 2: INIT_SCRIPT - External script file (for complex setups)
# Path to a bash script relative to workspace
INIT_SCRIPT=""
# INIT_SCRIPT=".dvytr/init.sh"

# Note: The current working directory is automatically mounted to /workspace
# All configuration values are optional

# ==============================================================================
# ADVANCED EXAMPLES
# ==============================================================================

# Example: Node.js project with PostgreSQL and AWS access
# CONTAINER_NAME="my-node-app"
# DOCKER_PORT_MAPPINGS=("3000:3000" "5432:5432")
# ENV_VARS=(
#     "NODE_ENV=development"
#     "DATABASE_URL=postgres://user:pass@host.docker.internal:5432/mydb"
#     "AWS_PROFILE=my-profile"
# )
# ADDITIONAL_VOLUMES=(
#     "$HOME/.aws:/home/dev/.aws:ro"
#     "/var/run/docker.sock:/var/run/docker.sock"
# )

# Example: Monorepo with private npm packages
# CONTAINER_NAME="my-monorepo"
# DOCKER_PORT_MAPPINGS=("8080:8080")
# ENV_VARS=(
#     "PNPM_HOME=/home/dev/.local/share/pnpm"
# )
# ADDITIONAL_VOLUMES=(
#     "$HOME/.npmrc:/home/dev/.npmrc:ro"
# )

# Example: Vite dev server (recommended: use VITE_HOST env var)
# CONTAINER_NAME="my-vite-app"
# DOCKER_PORT_MAPPINGS=("5173:5173")
# ENV_VARS=(
#     "VITE_HOST=0.0.0.0"
# )
# Then run: pnpm dev (or npm run dev, vite, etc.)
#
# Alternative approaches:
# 1. Use --host flag: vite --host 0.0.0.0
# 2. If you can't configure the service at all:
#    DOCKER_PORT_MAPPINGS=("5173:5174")
#    SOCAT_FORWARDS=("5174:127.0.0.1:5173")

# Example: Using password managers for secrets
# CONTAINER_NAME="secure-app"
# DOCKER_PORT_MAPPINGS=("3000:3000")
# ENV_VARS=(
#     "NODE_ENV=production"
#     # Using passage (age-based encryption):
#     "API_KEY=passage://services/myapp/api-key"           # Retrieved from passage
#     "DATABASE_URL=passage://databases/myapp/connection"  # Retrieved from passage
#     # Using pass (GPG-based encryption):
#     "JWT_SECRET=pass://secrets/myapp/jwt"                # Retrieved from pass
#     "AWS_SECRET=pass://aws/credentials/secret"           # Retrieved from pass
#     # Regular env var:
#     "DEBUG=false"
# )
# ADDITIONAL_VOLUMES=(
#     "$HOME/.passage:/home/dev/.passage:ro"   # Mount passage store (read-only)
#     "$HOME/.password-store:/home/dev/.password-store:ro"  # Mount pass store (read-only)
# )
#
# Prerequisites for passage:
# 1. Install passage: https://github.com/FiloSottile/passage
# 2. Initialize passage store: passage init <age-public-key>
# 3. Add secrets: passage insert services/myapp/api-key
#
# Prerequisites for pass:
# 1. Install pass: https://www.passwordstore.org/
# 2. Initialize pass store: pass init <gpg-key-id>
# 3. Add secrets: pass insert secrets/myapp/jwt
#
# Secrets are retrieved when running 'dvytr run' before container creation
